layui.define("layer",function(s){var d=layui.$,r=layui.layer,j=layui.hint(),l=layui.device(),q={config:{},set:function(t){var u=this;u.config=d.extend({},u.config,t);return u},on:function(t,u){return layui.onevent.call(this,g,t,u)}},o=function(){var t=this;return{upload:function(u){t.upload.call(t,u)},reload:function(u){t.reload.call(t,u)},config:t.config}},g="upload",a=".layui-upload",f="layui-this",c="layui-show",n="layui-hide",p="layui-disabled",e="layui-upload-file",i="layui-upload-form",k="layui-upload-iframe",h="layui-upload-choose",b="layui-upload-drag",m=function(t){var u=this;u.config=d.extend({},u.config,q.config,t);u.render()};m.prototype.config={accept:"images",exts:"",auto:true,bindAction:"",url:"",field:"file",acceptMime:"",method:"post",data:{},drag:true,size:0,number:0,multiple:false};m.prototype.render=function(t){var u=this,t=u.config;t.elem=d(t.elem);t.bindAction=d(t.bindAction);u.file();u.events()};m.prototype.file=function(){var v=this,t=v.config,w=v.elemFile=d(['<input class="'+e+'" type="file" accept="'+t.acceptMime+'" name="'+t.field+'"',(t.multiple?" multiple":""),">"].join("")),u=t.elem.next();if(u.hasClass(e)||u.hasClass(i)){u.remove()}if(l.ie&&l.ie<10){t.elem.wrap('<div class="layui-upload-wrap"></div>')}v.isFile()?(v.elemFile=t.elem,t.field=t.elem[0].name):t.elem.after(w);if(l.ie&&l.ie<10){v.initIE()}};m.prototype.initIE=function(){var v=this,t=v.config,u=d('<iframe id="'+k+'" class="'+k+'" name="'+k+'" frameborder="0"></iframe>'),w=d(['<form target="'+k+'" class="'+i+'" method="post" key="set-mine" enctype="multipart/form-data" action="'+t.url+'">',"</form>"].join(""));d("#"+k)[0]||d("body").append(u);if(!t.elem.next().hasClass(i)){v.elemFile.wrap(w);t.elem.next("."+i).append(function(){var x=[];layui.each(t.data,function(y,z){z=typeof z==="function"?z():z;x.push('<input type="hidden" name="'+y+'" value="'+z+'">')});return x.join("")}())}};m.prototype.msg=function(t){return r.msg(t,{icon:2,shift:6})};m.prototype.isFile=function(){var t=this.config.elem[0];if(!t){return}return t.tagName.toLocaleLowerCase()==="input"&&t.type==="file"};m.prototype.preview=function(u){var t=this;if(window.FileReader){layui.each(t.chooseFiles,function(w,x){var v=new FileReader();v.readAsDataURL(x);v.onload=function(){u&&u(w,x,this.result)}})}};m.prototype.upload=function(t,D){var A=this,G=A.config,z=A.elemFile[0],H=function(){var L=0,K=0,J=t||A.files||A.chooseFiles||z.files,I=function(){if(G.multiple&&L+K===A.fileLength){typeof G.allDone==="function"&&G.allDone({total:A.fileLength,successful:L,aborted:K})}};layui.each(J,function(M,N){var O=new FormData();O.append(G.field,N);layui.each(G.data,function(P,Q){Q=typeof Q==="function"?Q():Q;O.append(P,Q)});d.ajax({url:G.url,type:"post",data:O,contentType:false,processData:false,dataType:"json",headers:G.headers||{},success:function(P){L++;y(M,P);I()},error:function(){K++;A.msg("请求上传接口出现异常");C(M);I()}})})},E=function(){var I=d("#"+k);A.elemFile.parent().submit();clearInterval(m.timer);m.timer=setInterval(function(){var J,K=I.contents().find("body");try{J=K.text()}catch(L){A.msg("获取上传后的响应信息出现异常");clearInterval(m.timer);C()}if(J){clearInterval(m.timer);K.html("");y(0,J)}},30)},y=function(I,J){A.elemFile.next("."+h).remove();z.value="";if(typeof J!=="object"){try{J=JSON.parse(J)}catch(K){J={};return A.msg("请对上传接口返回有效JSON")}}typeof G.done==="function"&&G.done(J,I||0,function(L){A.upload(L)})},C=function(I){if(G.auto){z.value=""}typeof G.error==="function"&&G.error(I||0,function(J){A.upload(J)})},x=G.exts,u,F=function(){var I=[];layui.each(t||A.chooseFiles,function(J,K){I.push(K.name)});return I}(),B={preview:function(I){A.preview(I)},upload:function(J,K){var I={};I[J]=K;A.upload(I)},pushFile:function(){A.files=A.files||{};layui.each(A.chooseFiles,function(I,J){A.files[I]=J});return A.files},resetFile:function(K,L,J){var I=new File([L],J);A.files=A.files||{};A.files[K]=I}},v=function(){if(D==="choose"||G.auto){G.choose&&G.choose(B);if(D==="choose"){return}}G.before&&G.before(B);if(l.ie){return l.ie>9?H():E()}H()};F=F.length===0?((z.value.match(/[^\/\\]+\..+/g)||[])||""):F;if(F.length===0){return}switch(G.accept){case"file":if(x&&!RegExp("\\w\\.("+x+")$","i").test(escape(F))){A.msg("选择的文件中包含不支持的格式");return z.value=""}break;case"video":if(!RegExp("\\w\\.("+(x||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(F))){A.msg("选择的视频中包含不支持的格式");return z.value=""}break;case"audio":if(!RegExp("\\w\\.("+(x||"mp3|wav|mid")+")$","i").test(escape(F))){A.msg("选择的音频中包含不支持的格式");return z.value=""}break;default:layui.each(F,function(I,J){if(!RegExp("\\w\\.("+(x||"jpg|png|gif|bmp|jpeg$")+")","i").test(escape(J))){u=true}});if(u){A.msg("选择的图片中包含不支持的格式");return z.value=""}break}A.fileLength=function(){var J=0,I=t||A.files||A.chooseFiles||z.files;layui.each(I,function(){J++});return J}();if(G.number&&A.fileLength>G.number){return A.msg("同时最多只能上传的数量为："+G.number)}if(G.size>0&&!(l.ie&&l.ie<10)){var w;layui.each(A.chooseFiles,function(I,K){if(K.size>1024*G.size){var J=G.size/1024;
J=J>=1?(J.toFixed(2)+"MB"):G.size+"KB";z.value="";w=J}});if(w){return A.msg("文件不能超过"+w)}}v()};m.prototype.reload=function(t){t=t||{};delete t.elem;delete t.bindAction;var v=this,t=v.config=d.extend({},v.config,q.config,t),u=t.elem.next();u.attr({name:t.name,accept:t.acceptMime,multiple:t.multiple})};m.prototype.events=function(){var v=this,t=v.config,u=function(x){v.chooseFiles={};layui.each(x,function(y,z){var A=new Date().getTime();v.chooseFiles[A+"-"+y]=z})},w=function(y,x){var A=v.elemFile,z=y.length>1?y.length+"个文件":((y[0]||{}).name||(A[0].value.match(/[^\/\\]+\..+/g)||[])||"");if(A.next().hasClass(h)){A.next().remove()}v.upload(null,"choose");if(v.isFile()||t.choose){return}A.after('<span class="layui-inline '+h+'">'+z+"</span>")};t.elem.off("upload.start").on("upload.start",function(){var y=d(this),x=y.attr("lay-data");if(x){try{x=new Function("return "+x)();v.config=d.extend({},t,x)}catch(z){j.error("Upload element property lay-data configuration item has a syntax error: "+x)}}v.config.item=y;v.elemFile[0].click()});if(!(l.ie&&l.ie<10)){t.elem.off("upload.over").on("upload.over",function(){var x=d(this);x.attr("lay-over","")}).off("upload.leave").on("upload.leave",function(){var x=d(this);x.removeAttr("lay-over")}).off("upload.drop").on("upload.drop",function(z,A){var y=d(this),x=A.originalEvent.dataTransfer.files||[];y.removeAttr("lay-over");u(x);if(t.auto){v.upload(x)}else{w(x)}})}v.elemFile.off("upload.change").on("upload.change",function(){var x=this.files||[];u(x);t.auto?v.upload():w(x)});t.bindAction.off("upload.action").on("upload.action",function(){v.upload()});if(t.elem.data("haveEvents")){return}v.elemFile.on("change",function(){d(this).trigger("upload.change")});t.elem.on("click",function(){if(v.isFile()){return}d(this).trigger("upload.start")});if(t.drag){t.elem.on("dragover",function(x){x.preventDefault();d(this).trigger("upload.over")}).on("dragleave",function(x){d(this).trigger("upload.leave")}).on("drop",function(x){x.preventDefault();d(this).trigger("upload.drop",x)})}t.bindAction.on("click",function(){d(this).trigger("upload.action")});t.elem.data("haveEvents",true)};q.render=function(t){var u=new m(t);return o.call(u)};s(g,q)});