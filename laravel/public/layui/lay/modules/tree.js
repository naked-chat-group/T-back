layui.define("form",function(y){var g=layui.$,b=layui.form,k="tree",m={config:{},index:layui[k]?(layui[k].index+10000):0,set:function(z){var A=this;A.config=g.extend({},A.config,z);return A},on:function(z,A){return layui.onevent.call(this,k,z,A)}},a=function(){var A=this,z=A.config,B=z.id||A.index;a.that[B]=A;a.config[B]=z;return{config:z,reload:function(C){A.reload.call(A,C)},getChecked:function(){return A.getChecked.call(A)},setChecked:function(C){return A.setChecked.call(A,C)}}},w=function(A){var z=a.config[A];if(!z){hint.error("The ID option was not found in the "+k+" instance")}return z||null},f="layui-show",s="layui-hide",j="layui-none",t="layui-disabled",v="layui-tree",d="layui-tree-set",u="layui-tree-iconClick",n="layui-icon-addition",i="layui-icon-subtraction",l="layui-tree-entry",p="layui-tree-main",x="layui-tree-txt",e="layui-tree-pack",o="layui-tree-spread",q="layui-tree-setLineShort",h="layui-tree-showLine",c="layui-tree-lineExtend",r=function(z){var A=this;A.index=++m.index;A.config=g.extend({},A.config,m.config,z);A.render()};r.prototype.config={data:[],showCheckbox:false,showLine:true,accordion:false,onlyIconControl:false,isJump:false,edit:false,text:{defaultNodeName:"未命名",none:"无数据"}};r.prototype.reload=function(z){var A=this;layui.each(z,function(B,C){if(C.constructor===Array){delete A.config[B]}});A.config=g.extend(true,{},A.config,z);A.render()};r.prototype.render=function(){var B=this,A=B.config;var z=g('<div class="layui-tree'+(A.showCheckbox?" layui-form":"")+(A.showLine?" layui-tree-line":"")+'" lay-filter="LAY-tree-'+B.index+'"></div>');B.tree(z);var C=A.elem=g(A.elem);if(!C[0]){return}if(A.showSearch){z.prepend('<input type="text" class="layui-input layui-tree-search" placeholder="请输入关键字进行过滤">')}B.key=A.id||B.index;B.elem=z;B.elemNone=g('<div class="layui-tree-emptyText">'+A.text.none+"</div>");C.html(B.elem);if(B.elem.find(".layui-tree-set").length==0){return B.elem.append(B.elemNone)}A.drag&&B.drag();if(A.showCheckbox){B.renderForm("checkbox")}B.elem.find(".layui-tree-set").each(function(){var D=g(this);if(!D.parent(".layui-tree-pack")[0]){D.addClass("layui-tree-setHide")}if(!D.next()[0]&&D.parents(".layui-tree-pack").eq(1).hasClass("layui-tree-lineExtend")){D.addClass(q)}if(!D.next()[0]&&!D.parents(".layui-tree-set").eq(0).next()[0]){D.addClass(q)}});B.events()};r.prototype.renderForm=function(z){b.render(z,"LAY-tree-"+this.index)};r.prototype.tree=function(C,A){var B=this,z=B.config,D=A||z.data;layui.each(D,function(F,H){var I=H.children&&H.children.length>0,G=g('<div class="layui-tree-pack" '+(H.spread?'style="display: block;"':"")+'"></div>'),E=g(['<div data-id="'+H.id+'" class="layui-tree-set'+(H.spread?" layui-tree-spread":"")+(H.checked?" layui-tree-checkedFirst":"")+'">',"<div "+(z.drag&&!H.fixed?'draggable="true"':"")+' class="layui-tree-entry">','<div class="layui-tree-main">',function(){if(z.showLine){if(I){return'<span class="layui-tree-iconClick layui-tree-icon"><i class="layui-icon '+(H.spread?"layui-icon-subtraction":"layui-icon-addition")+'"></i></span>'}else{return'<span class="layui-tree-iconClick"><i class="layui-icon layui-icon-file"></i></span>'}}else{return'<span class="layui-tree-iconClick"><i class="layui-tree-iconArrow '+(I?"":s)+'"></i></span>'}}(),function(){return z.showCheckbox?'<input type="checkbox" name="layuiTreeCheck" lay-skin="primary" '+(H.disabled?"disabled":"")+'  value="'+H.id+'">':""}(),function(){if(z.isJump&&H.href){return'<a href="'+H.href+'" target="_blank" class="'+x+'">'+(H.title||H.label||z.text.defaultNodeName)+"</a>"}else{return'<span class="'+x+(H.disabled?" "+t:"")+'">'+(H.title||H.label||z.text.defaultNodeName)+"</span>"}}(),"</div>",function(){if(!z.edit){return""}var K={add:'<i class="layui-icon layui-icon-add-1"  data-type="add"></i>',update:'<i class="layui-icon layui-icon-edit" data-type="update"></i>',del:'<i class="layui-icon layui-icon-delete" data-type="del"></i>'},J=['<div class="layui-btn-group layui-tree-btnGroup">'];if(z.edit===true){z.edit=["update","del"]}if(typeof z.edit==="object"){layui.each(z.edit,function(L,M){J.push(K[M]||"")});return J.join("")+"</div>"}}(),"</div></div>"].join(""));if(I){E.append(G);B.tree(G,H.children)}C.append(E);if(E.prev("."+d)[0]){E.prev().children(".layui-tree-pack").addClass("layui-tree-showLine")}if(!I){E.parent(".layui-tree-pack").addClass("layui-tree-lineExtend")}B.spread(E,H);if(z.showCheckbox){B.checkClick(E,H)}z.edit&&B.operate(E,H)})};r.prototype.spread=function(B,H){var D=this,I=D.config,E=B.children("."+l),C=E.children("."+p),F=E.find("."+u),A=E.find("."+x),G=I.onlyIconControl?F:C,z="";G.on("click",function(L){var J=B.children("."+e),M=G.children(".layui-icon")[0]?G.children(".layui-icon"):G.find(".layui-tree-icon").children(".layui-icon");if(!J[0]){z="normal"}else{if(B.hasClass(o)){B.removeClass(o);J.slideUp(200);M.removeClass(i).addClass(n)}else{B.addClass(o);J.slideDown(200);M.addClass(i).removeClass(n);if(I.accordion){var K=B.siblings("."+d);K.removeClass(o);K.children("."+e).slideUp(200);
K.find(".layui-tree-icon").children(".layui-icon").removeClass(i).addClass(n)}}}});A.on("click",function(){var J=g(this);if(J.hasClass(t)){return}if(B.hasClass(o)){z=I.onlyIconControl?"open":"close"}else{z=I.onlyIconControl?"close":"open"}I.click&&I.click({elem:B,state:z,data:H})})};r.prototype.setCheckbox=function(E,D,z){var C=this,A=C.config,B=z.prop("checked");if(typeof D.children==="object"||E.find("."+e)[0]){var F=E.find("."+e).find('input[name="layuiTreeCheck"]');F.each(function(){if(this.disabled){return}this.checked=B})}var G=function(L){if(!L.parents("."+d)[0]){return}var J,K=L.parent("."+e),H=K.parent(),I=K.prev().find('input[name="layuiTreeCheck"]');if(B){I.prop("checked",B)}else{K.find('input[name="layuiTreeCheck"]').each(function(){if(this.checked){J=true}});J||I.prop("checked",false)}G(H)};G(E);C.renderForm("checkbox")};r.prototype.checkClick=function(E,D){var C=this,z=C.config,B=E.children("."+l),A=B.children("."+p);A.on("click",'input[name="layuiTreeCheck"]+',function(H){layui.stope(H);var F=g(this).prev(),G=F.prop("checked");if(F.prop("disabled")){return}C.setCheckbox(E,D,F);z.oncheck&&z.oncheck({elem:E,checked:G,data:D})})};r.prototype.operate=function(E,D){var C=this,z=C.config,B=E.children("."+l),A=B.children("."+p);B.children(".layui-tree-btnGroup").on("click",".layui-icon",function(I){layui.stope(I);var J=g(this).data("type"),S=E.children("."+e),P={data:D,type:J,elem:E};if(J=="add"){if(!S[0]){if(z.showLine){A.find("."+u).addClass("layui-tree-icon");A.find("."+u).children(".layui-icon").addClass(n).removeClass("layui-icon-file")}else{A.find(".layui-tree-iconArrow").removeClass(s)}E.append('<div class="layui-tree-pack"></div>')}var Q=z.operate&&z.operate(P),G={};G.title=z.text.defaultNodeName;G.id=Q;C.tree(E.children("."+e),[G]);if(z.showLine){if(!S[0]){var L=E.siblings("."+d),H=1,T=E.parent("."+e);layui.each(L,function(U,V){if(!g(V).children("."+e)[0]){H=0}});if(H==1){L.children("."+e).addClass(h);L.children("."+e).children("."+d).removeClass(q);E.children("."+e).addClass(h);T.removeClass(c);T.children("."+d).last().children("."+e).children("."+d).last().addClass(q)}else{E.children("."+e).children("."+d).addClass(q)}}else{if(!S.hasClass(c)){S.addClass(c)}E.find("."+e).each(function(){g(this).children("."+d).last().addClass(q)});if(S.children("."+d).last().prev().hasClass(q)){S.children("."+d).last().prev().removeClass(q)}else{S.children("."+d).last().removeClass(q)}if(!E.parent("."+e)[0]&&E.next()[0]){S.children("."+d).last().removeClass(q)}}}if(!z.showCheckbox){return}if(A.find('input[name="layuiTreeCheck"]')[0].checked){var O=E.children("."+e).children("."+d).last();O.find('input[name="layuiTreeCheck"]')[0].checked=true}C.renderForm("checkbox")}else{if(J=="update"){var R=A.children("."+x).html();A.children("."+x).html("");A.append('<input type="text" class="layui-tree-editInput">');A.children(".layui-tree-editInput").val(R).focus();var N=function(U){var V=U.val().trim();V=V?V:z.text.defaultNodeName;U.remove();A.children("."+x).html(V);P.data.title=V;z.operate&&z.operate(P)};A.children(".layui-tree-editInput").blur(function(){N(g(this))});A.children(".layui-tree-editInput").on("keydown",function(U){if(U.keyCode===13){U.preventDefault();N(g(this))}})}else{z.operate&&z.operate(P);P.status="remove";if(!E.prev("."+d)[0]&&!E.next("."+d)[0]&&!E.parent("."+e)[0]){E.remove();C.elem.append(C.elemNone);return}if(E.siblings("."+d).children("."+l)[0]){if(z.showCheckbox){var K=function(X){if(!X.parents("."+d)[0]){return}var Z=X.siblings("."+d).children("."+l),W=X.parent("."+e).prev(),V=W.find('input[name="layuiTreeCheck"]')[0],Y=1,U=0;if(V.checked==false){Z.each(function(ac,ab){var aa=g(ab).find('input[name="layuiTreeCheck"]')[0];if(aa.checked==false&&!aa.disabled){Y=0}if(!aa.disabled){U=1}});if(Y==1&&U==1){V.checked=true;C.renderForm("checkbox");K(W.parent("."+d))}}};K(E)}if(z.showLine){var L=E.siblings("."+d),H=1,T=E.parent("."+e);layui.each(L,function(U,V){if(!g(V).children("."+e)[0]){H=0}});if(H==1){if(!S[0]){T.removeClass(c);L.children("."+e).addClass(h);L.children("."+e).children("."+d).removeClass(q)}if(!E.next()[0]){E.prev().children("."+e).children("."+d).last().addClass(q)}else{T.children("."+d).last().children("."+e).children("."+d).last().addClass(q)}if(!E.next()[0]&&!E.parents("."+d)[1]&&!E.parents("."+d).eq(0).next()[0]){E.prev("."+d).addClass(q)}}else{if(!E.next()[0]&&E.hasClass(q)){E.prev().addClass(q)}}}}else{var F=E.parent("."+e).prev();if(z.showLine){F.find("."+u).removeClass("layui-tree-icon");F.find("."+u).children(".layui-icon").removeClass(i).addClass("layui-icon-file");var M=F.parents("."+e).eq(0);M.addClass(c);M.children("."+d).each(function(){g(this).children("."+e).children("."+d).last().addClass(q)})}else{F.find(".layui-tree-iconArrow").addClass(s)}E.parents("."+d).eq(0).removeClass(o);E.parent("."+e).remove()}E.remove()}}})};r.prototype.drag=function(){var A=this,z=A.config;A.elem.on("dragstart","."+l,function(){var C=g(this).parent("."+d),B=C.parents("."+d)[0]?C.parents("."+d).eq(0):"未找到父节点";
z.dragstart&&z.dragstart(C,B)});A.elem.on("dragend","."+l,function(Q){var Q=Q||event,E=Q.clientY,R=g(this),C=R.parent("."+d),G=C.height(),N=C.offset().top,B=A.elem.find("."+d),P=A.elem.height(),D=A.elem.offset().top,T=P+D-13;var O=C.parents("."+d)[0],L=C.next()[0];if(O){var M=C.parent("."+e),H=C.parents("."+d).eq(0),F=H.parent("."+e),I=H.offset().top,S=C.siblings(),J=H.children("."+e).children("."+d).length}var K=function(W){if(!O&&!L){A.elem.children("."+d).last().children("."+e).children("."+d).last().addClass(q)}if(!O){C.removeClass("layui-tree-setHide");return}if(J==1){if(z.showLine){W.find("."+u).removeClass("layui-tree-icon");W.find("."+u).children(".layui-icon").removeClass(i).addClass("layui-icon-file");F.addClass(c);F.children("."+d).children("."+e).each(function(){g(this).children("."+d).last().addClass(q)})}else{W.find(".layui-tree-iconArrow").addClass(s)}W.children("."+e).remove();W.removeClass(o)}else{if(z.showLine){var V=1;layui.each(S,function(X,Y){if(!g(Y).children("."+e)[0]){V=0}});if(V==1){if(!C.children("."+e)[0]){M.removeClass(c);S.children("."+e).addClass(h);S.children("."+e).children("."+d).removeClass(q)}M.children("."+d).last().children("."+e).children("."+d).last().addClass(q);if(!L&&!W.parents("."+d)[0]&&!W.next()[0]){M.children("."+d).last().addClass(q)}}else{if(!L&&C.hasClass(q)){M.children("."+d).last().addClass(q)}}}if(z.showCheckbox){var U=function(aa){if(aa){if(!aa.parents("."+d)[0]){return}}else{if(!W[0]){return}}var ac=aa?aa.siblings().children("."+l):S.children("."+l),Z=aa?aa.parent("."+e).prev():M.prev(),Y=Z.find('input[name="layuiTreeCheck"]')[0],ab=1,X=0;if(Y.checked==false){ac.each(function(af,ae){var ad=g(ae).find('input[name="layuiTreeCheck"]')[0];if(ad.checked==false&&!ad.disabled){ab=0}if(!ad.disabled){X=1}});if(ab==1&&X==1){Y.checked=true;A.renderForm("checkbox");U(Z.parent("."+d)||W)}}};U()}}};B.each(function(){if(g(this).height()!=0){if((E>N&&E<N+G)){z.dragend&&z.dragend("drag error");return}if(J==1&&E>I&&E<N+G){z.dragend&&z.dragend("drag error");return}var W=g(this).offset().top;if((E>W)&&(E<W+15)){if(!g(this).children("."+e)[0]){if(z.showLine){g(this).find("."+u).eq(0).addClass("layui-tree-icon");g(this).find("."+u).eq(0).children(".layui-icon").addClass(n).removeClass("layui-icon-file")}else{g(this).find(".layui-tree-iconArrow").removeClass(s)}g(this).append('<div class="layui-tree-pack"></div>')}g(this).children("."+e).append(C);K(H);if(z.showLine){var V=g(this).children("."+e).children("."+d);C.children("."+e).children("."+d).last().addClass(q);if(V.length==1){var X=g(this).siblings("."+d),ac=1,ab=g(this).parent("."+e);layui.each(X,function(ad,ae){if(!g(ae).children("."+e)[0]){ac=0}});if(ac==1){X.children("."+e).addClass(h);X.children("."+e).children("."+d).removeClass(q);g(this).children("."+e).addClass(h);ab.removeClass(c);ab.children("."+d).last().children("."+e).children("."+d).last().addClass(q).removeClass("layui-tree-setHide")}else{g(this).children("."+e).children("."+d).addClass(q).removeClass("layui-tree-setHide")}}else{if(C.prev("."+d).hasClass(q)){C.prev("."+d).removeClass(q);C.addClass(q)}else{C.removeClass("layui-tree-setLineShort layui-tree-setHide");if(!C.children("."+e)[0]){C.siblings("."+d).find("."+e).each(function(){g(this).children("."+d).last().addClass(q)})}else{C.prev("."+d).children("."+e).children("."+d).last().removeClass(q)}}if(!g(this).next()[0]){C.addClass(q)}}}if(z.showCheckbox){if(g(this).children("."+l).find('input[name="layuiTreeCheck"]')[0].checked){var Y=C.children("."+l);Y.find('input[name="layuiTreeCheck"]+').click()}}z.dragend&&z.dragend("drag success",C,g(this));return false}else{if(E<W){g(this).before(C);K(H);if(z.showLine){var Z=C.children("."+e),aa=g(this).parents("."+d).eq(0),U=aa.children("."+e).children("."+d).last();if(Z[0]){C.removeClass(q);Z.children("."+d).last().removeClass(q);var X=C.siblings("."+d),ac=1;layui.each(X,function(ad,ae){if(!g(ae).children("."+e)[0]){ac=0}});if(ac==1){if(aa[0]){X.children("."+e).addClass(h);X.children("."+e).children("."+d).removeClass(q);U.children("."+e).children("."+d).last().addClass(q).removeClass(h)}}else{C.children("."+e).children("."+d).last().addClass(q)}if(!aa.parent("."+e)[0]&&aa.next()[0]){U.removeClass(q)}}else{if(!aa.hasClass(c)){aa.addClass(c)}aa.find("."+e).each(function(){g(this).children("."+d).last().addClass(q)})}if(!aa[0]){C.addClass("layui-tree-setHide");C.children("."+e).children("."+d).last().removeClass(q)}}if(aa[0]&&z.showCheckbox){if(aa.children("."+l).find('input[name="layuiTreeCheck"]')[0].checked){var Y=C.children("."+l);Y.find('input[name="layuiTreeCheck"]+').click()}}z.dragend&&z.dragend("拖拽成功，插入目标节点上方",C,g(this));return false}else{if(E>T){A.elem.children("."+d).last().children("."+e).addClass(h);A.elem.append(C);K(H);C.prev().children("."+e).children("."+d).last().removeClass(q);C.addClass("layui-tree-setHide");C.children("."+e).children("."+d).last().addClass(q);z.dragend&&z.dragend("拖拽成功，插入最外层节点",C,A.elem);return false}}}}})})};r.prototype.events=function(){var B=this,A=B.config,z=B.elem.find(".layui-tree-checkedFirst");
layui.each(z,function(C,D){g(D).children("."+l).find('input[name="layuiTreeCheck"]+').trigger("click")});B.elem.find(".layui-tree-search").on("keyup",function(){var D=g(this),F=D.val(),E=D.nextAll(),C=[];E.find("."+x).each(function(){var H=g(this).parents("."+l);if(g(this).html().indexOf(F)!=-1){C.push(g(this).parent());var G=function(I){I.addClass("layui-tree-searchShow");if(I.parent("."+e)[0]){G(I.parent("."+e).parent("."+d))}};G(H.parent("."+d))}});E.find("."+l).each(function(){var G=g(this).parent("."+d);if(!G.hasClass("layui-tree-searchShow")){G.addClass(s)}});if(E.find(".layui-tree-searchShow").length==0){B.elem.append(B.elemNone)}A.onsearch&&A.onsearch({elem:C})});B.elem.find(".layui-tree-search").on("keydown",function(){g(this).nextAll().find("."+l).each(function(){var C=g(this).parent("."+d);C.removeClass("layui-tree-searchShow "+s)});if(g(".layui-tree-emptyText")[0]){g(".layui-tree-emptyText").remove()}})};r.prototype.getChecked=function(){var D=this,A=D.config,C=[],z=[];D.elem.find(".layui-form-checked").each(function(){C.push(g(this).prev()[0].value)});var B=function(F,E){layui.each(F,function(G,H){layui.each(C,function(K,I){if(H.id==I){var J=g.extend({},H);delete J.children;E.push(J);if(H.children){J.children=[];B(H.children,J.children)}return true}})})};B(g.extend({},A.data),z);return z};r.prototype.setChecked=function(z){var B=this,A=B.config;B.elem.find("."+d).each(function(F,G){var D=g(this).data("id"),E=g(G).children("."+l).find('input[name="layuiTreeCheck"]'),C=E.next();if(typeof z==="number"){if(D==z){if(!E[0].checked){C.click()}return false}}else{if(g.inArray(D,z)!=-1){if(!E[0].checked){C.click()}}}})};a.that={};a.config={};m.reload=function(B,z){var A=a.that[B];A.reload(z);return a.call(A)};m.getChecked=function(A){var z=a.that[A];return z.getChecked()};m.setChecked=function(B,z){var A=a.that[B];return A.setChecked(z)};m.render=function(z){var A=new r(z);return a.call(A)};y(k,m)});